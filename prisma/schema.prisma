generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  clerkId   String   @unique
  email     String
  vehicles  Vehicle[]
  invoices  Invoice[]
  createdAt DateTime @default(now())
}

model Vehicle {
  id             String    @id @default(uuid())
  make           String    // e.g. Toyota
  model          String    // e.g. Fortuner
  regNumber      String    @unique // e.g. MH-01-AB-12
  userId         String
  user           User      @relation(fields: [userId], references: [id])
  invoices       Invoice[]
  createdAt      DateTime  @default(now())
}

model Invoice {
  id             String   @id @default(uuid())
  fileUrl        String   // S3 or Blob URL
  serviceDate    DateTime
  serviceCenter  String
  totalCost      Float
  odometer       Int?
  
  vehicleId      String
  vehicle        Vehicle  @relation(fields: [vehicleId], references: [id])
  
  userId         String
  user           User     @relation(fields: [userId], references: [id])

  lineItems      LineItem[]
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model LineItem {
  id          String  @id @default(uuid())
  description String  // e.g. "Brake Pad Replacement"
  quantity    Int     @default(1)
  unitPrice   Float
  totalPrice  Float
  category    String  // "Part" or "Labor"
  
  invoiceId   String
  invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}